<!doctype html><html lang=en class=color-toggle-hidden><head><meta charset=utf-8><meta name=referrer content="no-referrer"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=generator content="Hugo 0.99.1"><meta name=description content="Debian is an operating system with a rich packaging format and dependency resolution system. It runs on the Linux kernel and provides over 80,000 packages. Packages ranging from shells like bash, server software like nginx, desktop software like Firefox, and even full-blown desktop environments like Gnome. The Ubuntu operating system is a Debian variant which adopts many of the same packages as Debian, providing a commercial facade and a different, potentially favorable package lifecycle."><title>Forking a Debian Package | RDKit-rs</title><link rel=icon type=image/svg+xml href=/favicon/favicon.svg><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><meta property="og:title" content="Forking a Debian Package"><meta property="og:site_name" content="RDKit-rs"><meta property="og:description" content="Debian is an operating system with a rich packaging format and dependency resolution system. It runs on the Linux kernel and provides over 80,000 packages. Packages ranging from shells like bash, server software like nginx, desktop software like Firefox, and even full-blown desktop environments like Gnome. The Ubuntu operating system is a Debian variant which adopts many of the same packages as Debian, providing a commercial facade and a different, potentially favorable package lifecycle."><meta property="og:type" content="article"><meta property="og:url" content="https://rdkit-rs.github.io/tutorials/forking-a-debian-package/"><meta property="article:section" content="Tutorials"><meta name=twitter:card content="summary"><meta name=twitter:title content="Forking a Debian Package"><meta name=twitter:description content="Debian is an operating system with a rich packaging format and dependency resolution system. It runs on the Linux kernel and provides over 80,000 packages. Packages ranging from shells like bash, server software like nginx, desktop software like Firefox, and even full-blown desktop environments like Gnome. The Ubuntu operating system is a Debian variant which adopts many of the same packages as Debian, providing a commercial facade and a different, potentially favorable package lifecycle."><script type=application/ld+json>{"@context":"http://schema.org","@type":"TechArticle","articleSection":"Tutorials","name":"Forking a Debian Package","url":"https://rdkit-rs.github.io/tutorials/forking-a-debian-package/","headline":"Forking a Debian Package","description":"Debian is an operating system with a rich packaging format and dependency resolution system. It runs on the Linux kernel and provides over 80,000 packages. Packages ranging from shells like bash, server software like nginx, desktop software like Firefox, and even full-blown desktop environments like Gnome. The Ubuntu operating system is a Debian variant which adopts many of the same packages as Debian, providing a commercial facade and a different, potentially favorable package lifecycle.","wordCount":"5465","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https://rdkit-rs.github.io/tutorials/forking-a-debian-package/"},"copyrightHolder":"RDKit-rs","copyrightYear":"0001","dateCreated":"0001-01-01T00:00:00.00Z","datePublished":"0001-01-01T00:00:00.00Z","dateModified":"0001-01-01T00:00:00.00Z","publisher":{"@type":"Organization","name":"RDKit-rs","url":"https://rdkit-rs.github.io/","logo":{"@type":"ImageObject","url":"https://rdkit-rs.github.io/brand.svg","width":"32","height":"32"}}}</script><script src=/js/colortheme-d3e4d351.bundle.min.js></script>
<script src=/js/main-fbb9c8b0.bundle.min.js></script>
<link rel=preload as=font href=/fonts/Metropolis.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/LiberationSans.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload href=/main-f44405f3.min.css as=style><link rel=stylesheet href=/main-f44405f3.min.css media=all><link rel=preload href=/mobile-79ddc617.min.css as=style><link rel=stylesheet href=/mobile-79ddc617.min.css media="screen and (max-width: 45rem)"><link rel=preload href=/print-735ccc12.min.css as=style><link rel=stylesheet href=/print-735ccc12.min.css media=print><link rel=preload href=/custom.css as=style><link rel=stylesheet href=/custom.css media=all><link href=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/ rel=canonical type=text/html></head><body itemscope itemtype=https://schema.org/WebPage><svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M24 10.526v2.947H5.755l8.351 8.421-2.105 2.105-12-12 12-12 2.105 2.105-8.351 8.421H24z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_left_alt" xmlns="http://www.w3.org/2000/svg"><path d="M5.965 10.526V6.035L0 12l5.965 5.965v-4.491H24v-2.947H5.965z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M18.035 10.526V6.035L24 12l-5.965 5.965v-4.491H0v-2.947h18.035z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427.0.808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15.268 4.392q.868.0 1.532.638t.664 1.506v17.463l-7.659-3.268-7.608 3.268V6.536q0-.868.664-1.506t1.532-.638h10.876zm4.34 14.144V4.392q0-.868-.638-1.532t-1.506-.664H6.537q0-.868.664-1.532T8.733.0h10.876q.868.0 1.532.664t.664 1.532v17.412z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_auto" xmlns="http://www.w3.org/2000/svg"><path d="M16.846 18.938h2.382L15.22 7.785h-2.44L8.772 18.938h2.382l.871-2.44h3.95zm7.087-9.062L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809zm-11.385 4.937L14 10.282l1.452 4.531h-2.904z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_dark" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079.0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565q-1.51.0-3.079.697 1.917.871 3.108 2.701T15.22 14t-1.191 4.037-3.108 2.701q1.568.697 3.079.697zm9.933-11.559L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_light" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079.0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565 8.743 8.743 6.565 14t2.178 5.257T14 21.435zm9.933-3.311v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809L27.999 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check" xmlns="http://www.w3.org/2000/svg"><path d="M8.885 20.197 25.759 3.323l2.24 2.24L8.885 24.677.0 15.792l2.24-2.24z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check_circle_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm6.441 7.822 1.972 1.972-11.239 11.239L4.207 14l1.972-1.972 4.995 4.995z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_cloud_off" xmlns="http://www.w3.org/2000/svg"><path d="M9.023 10.5H7q-1.914.0-3.281 1.395t-1.367 3.309 1.367 3.281T7 19.852h11.375zM3.5 4.976l1.477-1.477L24.5 23.022l-1.477 1.477-2.352-2.297H6.999q-2.898.0-4.949-2.051t-2.051-4.949q0-2.844 1.969-4.867t4.758-2.133zm19.086 5.578q2.242.164 3.828 1.832T28 16.351q0 3.008-2.461 4.758l-1.695-1.695q1.805-.984 1.805-3.063.0-1.422-1.039-2.461t-2.461-1.039h-1.75v-.602q0-2.68-1.859-4.539t-4.539-1.859q-1.531.0-2.953.711l-1.75-1.695Q11.431 3.5 14.001 3.5q2.953.0 5.496 2.078t3.09 4.977z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75.0 10-3.501.001 1.75 1.75.0 003.501-.001zm0-21a1.75 1.75.0 10-3.501.001A1.75 1.75.0 009.917 3.5zm11.666 2.333a1.75 1.75.0 10-3.501.001 1.75 1.75.0 003.501-.001zm1.75.0a3.502 3.502.0 01-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502.0 011.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502.0 014.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502.0 01-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502.0 01-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_copy" xmlns="http://www.w3.org/2000/svg"><path d="M23.502 25.438V7.626H9.562v17.812h13.94zm0-20.315q1.013.0 1.787.745t.774 1.757v17.812q0 1.013-.774 1.787t-1.787.774H9.562q-1.013.0-1.787-.774t-.774-1.787V7.625q0-1.013.774-1.757t1.787-.745h13.94zM19.689.0v2.562H4.438v17.812H1.936V2.562q0-1.013.745-1.787T4.438.001h15.251z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_dangerous" xmlns="http://www.w3.org/2000/svg"><path d="M21.802 19.833 15.969 14l5.833-5.833-1.969-1.969L14 12.031 8.167 6.198 6.198 8.167 12.031 14l-5.833 5.833 1.969 1.969L14 15.969l5.833 5.833zM19.833.0 28 8.167v11.666L19.833 28H8.167L0 19.833V8.167L8.167.0h11.666z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277.0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352.0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46.0v3.155h-3.155v-3.155h3.155zm-6.384.0v3.155h-3.23v-3.155h3.23z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277.0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277.0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_error_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 6.967h2.761v8.413H12.62V6.967zm0 11.239h2.761v2.826H12.62v-2.826z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_fire" xmlns="http://www.w3.org/2000/svg"><path d="M17.689 21.998q-.32.32-.8.576t-.864.384q-1.152.384-2.272.032t-1.888-.992q-.128-.128-.096-.256t.16-.192q1.216-.384 1.92-1.216t.96-1.792q.192-.896-.064-1.728t-.384-1.728q-.128-.704-.096-1.376t.288-1.312q0-.128.128-.128t.192.064q.384.832.992 1.472t1.28 1.216 1.216 1.248.672 1.568q.064.384.064.704.064.96-.32 1.92t-1.088 1.536zm3.84-10.944q-.768-.704-1.6-1.28t-1.6-1.344q-1.536-1.536-2.016-3.584t.16-4.16q.128-.32-.096-.544t-.544-.096q-.768.32-1.44.768t-1.312.896q-1.984 1.664-3.136 3.936T8.633 10.51t.8 5.088q0 .128.032.256t.032.256q0 .576-.512.832t-1.024-.192q-.128-.192-.192-.32-1.024-1.28-1.376-2.912t-.096-3.232q.064-.384-.288-.576t-.608.128q-1.28 1.664-1.856 3.68t-.448 4.064q0 .576.096 1.184t.288 1.184q.448 1.536 1.216 2.816 1.216 2.048 3.264 3.424t4.416 1.696q2.496.32 5.024-.256t4.448-2.304q1.408-1.344 2.208-3.104t.864-3.68-.704-3.712q-.064-.128-.096-.224t-.096-.224q-.576-1.088-1.28-1.984-.256-.384-.544-.704t-.672-.64z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753 15.247.529a1.803 1.803.0 00-2.55.0l-2.84 2.84 2.137 2.137a2.625 2.625.0 013.501 3.501l3.499 3.499a2.625 2.625.0 11-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626.0 11-1.75.0v-7.3a2.626 2.626.0 01-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805.0 000 2.551l12.225 12.224a1.803 1.803.0 002.55.0l12.168-12.168a1.805 1.805.0 000-2.551z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_gitea" xmlns="http://www.w3.org/2000/svg"><path d="M5.581 7.229c-2.46-.005-5.755 1.559-5.573 5.48.284 6.125 6.56 6.693 9.068 6.743.275 1.149 3.227 5.112 5.412 5.32h9.573c5.741-.381 10.04-17.363 6.853-17.427-5.271.248-8.395.373-11.073.395v5.3l-.835-.369-.005-4.928c-3.075-.001-5.781-.144-10.919-.397-.643-.004-1.539-.113-2.501-.116zm.348 2.166h.293c.349 3.14.917 4.976 2.067 7.781-2.933-.347-5.429-1.199-5.888-4.38-.237-1.647.563-3.365 3.528-3.401zm11.409 3.087c.2.003.404.04.596.128l.999.431-.716 1.305h-.007a.996.996.0 00-.321.053l.006-.002c-.349.114-.593.406-.593.749.0.097.019.189.055.275l-.002-.006a.767.767.0 00.151.233l-.001-.001-1.235 2.248a.99.99.0 00-.302.052l.006-.002c-.349.114-.593.406-.593.749.0.097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987.0 00.31-.049l-.006.002c.348-.114.592-.406.592-.749.0-.097-.02-.19-.056-.277l.002.006a.784.784.0 00-.211-.293l1.203-2.189a.999.999.0 00.397-.041l-.006.002a.942.942.0 00.285-.15l-.001.001c.464.195.844.353 1.117.488.411.203.556.337.6.487.044.147-.004.429-.236.925-.173.369-.46.893-.799 1.511h-.02a.991.991.0 00-.321.053l.006-.002c-.349.114-.593.406-.593.749.0.097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987.0 00.31-.049l-.006.002c.348-.114.592-.406.592-.749a.703.703.0 00-.055-.275l.002.006a.802.802.0 00-.183-.27l.001.001c.335-.611.623-1.136.808-1.531.251-.536.381-.935.267-1.32s-.467-.636-.933-.867c-.307-.151-.689-.311-1.147-.503a.723.723.0 00-.052-.324l.002.006a.792.792.0 00-.194-.279l.704-1.284 3.899 1.684c.704.305.995 1.053.653 1.68l-2.68 4.907c-.343.625-1.184.884-1.888.58l-5.516-2.384c-.704-.304-.996-1.053-.653-1.68l2.68-4.905c.235-.431.707-.687 1.207-.707z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833.0 15.999 7.166 15.999 15.999.0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771.0-.521.021-2.25.021-4.396.0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896.0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032.0 00-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291.0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896.0 1.333.021 2.583.021 2.979.0.417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25.0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229.0.375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354.0.396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187.0-.333.104-.333.229.0.146.146.25.354.229.187.0.333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034 14 26.888.442 17.048a1.09 1.09.0 01-.39-1.203l1.578-4.811zm7.217.0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548.0 011.031.0zm20.618 9.559 1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548.0 011.031.0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11.0 01-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125.0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339.0 8.535 3.125 8.535 8.357.0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_home" xmlns="http://www.w3.org/2000/svg"><path d="M24.003 15.695v8.336c0 .608-.504 1.111-1.111 1.111h-6.669v-6.669h-4.446v6.669H5.108a1.119 1.119.0 01-1.111-1.111v-8.336c0-.035.017-.069.017-.104L14 7.359l9.986 8.232a.224.224.0 01.017.104zm3.873-1.198-1.077 1.285a.578.578.0 01-.365.191h-.052a.547.547.0 01-.365-.122L14 5.831 1.983 15.851a.594.594.0 01-.417.122.578.578.0 01-.365-.191L.124 14.497a.57.57.0 01.069-.781L12.679 3.314c.729-.608 1.91-.608 2.64.0l4.237 3.543V3.471c0-.313.243-.556.556-.556h3.334c.313.0.556.243.556.556v7.085l3.803 3.161c.226.191.26.556.069.781z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_info_outline" xmlns="http://www.w3.org/2000/svg"><path d="M12.62 9.793V6.967h2.761v2.826H12.62zM14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 21.033V12.62h2.761v8.413H12.62z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_down" xmlns="http://www.w3.org/2000/svg"><path d="M3.281 5.36 14 16.079 24.719 5.36 28 8.641l-14 14-14-14z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25 22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25 18.375 16 6.125 3.75 9.875.0l15.999 15.999L9.875 31.998z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_up" xmlns="http://www.w3.org/2000/svg"><path d="M24.719 22.64 14 11.921 3.281 22.64.0 19.359l14-14 14 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_language" xmlns="http://www.w3.org/2000/svg"><path d="M20.112 16.826h4.732q.394-1.84.394-2.826t-.394-2.826h-4.732q.197 1.38.197 2.826t-.197 2.826zm-2.497 7.756q1.643-.526 3.418-2.005t2.695-2.991h-4.141q-.657 2.629-1.972 4.995zm-.329-7.756q.197-1.38.197-2.826t-.197-2.826h-6.573q-.197 1.38-.197 2.826t.197 2.826h6.573zM14 25.173q1.84-2.695 2.695-5.587h-5.39q.854 2.892 2.695 5.587zM8.413 8.413q.789-2.826 1.972-4.995-1.643.526-3.451 2.005T4.272 8.414h4.141zM4.272 19.587q.854 1.512 2.662 2.991t3.451 2.005q-1.315-2.366-1.972-4.995H4.272zm-1.117-2.761h4.732Q7.69 15.446 7.69 14t.197-2.826H3.155q-.394 1.84-.394 2.826t.394 2.826zM14 2.826q-1.84 2.695-2.695 5.587h5.39Q15.841 5.521 14 2.826zm9.727 5.587q-.92-1.512-2.695-2.991t-3.418-2.005q1.183 2.169 1.972 4.995h4.141zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305.0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028.0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305.0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028.0-3.493 1.465t-1.465 3.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_mastodon" xmlns="http://www.w3.org/2000/svg"><path d="M30.924 10.506c0-6.941-4.548-8.976-4.548-8.976C24.083.477 20.144.034 16.054.001h-.101C11.862.034 7.926.477 5.633 1.53c0 0-4.548 2.035-4.548 8.976.0 1.589-.031 3.491.02 5.505.165 6.79 1.245 13.479 7.522 15.14 2.893.765 5.379.927 7.38.816 3.629-.2 5.667-1.296 5.667-1.296l-.12-2.633s-2.593.817-5.505.719c-2.887-.099-5.932-.311-6.399-3.855a7.069 7.069.0 01-.064-.967v-.028.001s2.833.693 6.423.857c2.195.1 4.253-.129 6.344-.377 4.009-.479 7.5-2.949 7.939-5.207.689-3.553.633-8.676.633-8.676zm-5.366 8.945h-3.329v-8.159c0-1.72-.724-2.592-2.171-2.592-1.6.0-2.403 1.035-2.403 3.083v4.465h-3.311v-4.467c0-2.048-.803-3.083-2.403-3.083-1.447.0-2.171.873-2.171 2.592v8.159H6.441v-8.404c0-1.719.437-3.084 1.316-4.093.907-1.011 2.092-1.528 3.565-1.528 1.704.0 2.995.655 3.848 1.965l.828 1.391.829-1.391c.853-1.311 2.144-1.965 3.848-1.965 1.472.0 2.659.517 3.565 1.528.877 1.009 1.315 2.375 1.315 4.093z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_matrix" xmlns="http://www.w3.org/2000/svg"><path d="M.843.734v30.532H3.04v.733H0V0h3.04v.733zm9.391 9.68v1.543h.044a4.417 4.417.0 011.489-1.365c.577-.327 1.248-.487 2-.487.72.0 1.377.143 1.975.419.597.277 1.047.776 1.36 1.477.339-.499.8-.941 1.379-1.323.579-.383 1.267-.573 2.061-.573.604.0 1.163.075 1.68.223a3.34 3.34.0 011.324.707c.368.327.652.745.861 1.268.203.523.307 1.151.307 1.889v7.637h-3.132v-6.468c0-.381-.013-.745-.043-1.083a2.315 2.315.0 00-.246-.893l.006.013a1.484 1.484.0 00-.577-.593l-.007-.004c-.259-.147-.609-.221-1.047-.221-.443.0-.8.085-1.071.252-.267.166-.483.39-.635.656l-.005.009a2.558 2.558.0 00-.307.915l-.002.013a7.156 7.156.0 00-.08 1.044v6.359h-3.133v-6.4c0-.339-.005-.671-.024-1.003a2.772 2.772.0 00-.197-.936l.007.019a1.41 1.41.0 00-.548-.667l-.006-.003c-.259-.167-.635-.253-1.139-.253-.148.0-.345.032-.585.099-.24.068-.48.191-.707.376-.228.184-.425.449-.585.793-.16.345-.24.8-.24 1.36v6.621H7.279v-11.42zm20.923 20.852V.734H28.96V.001H32V32h-3.04v-.733z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_notification" xmlns="http://www.w3.org/2000/svg"><path d="m22.615 19.384 2.894 2.894v1.413H2.49v-1.413l2.894-2.894V12.25q0-3.365 1.716-5.856t4.745-3.231v-1.01q0-.875.606-1.514T13.999.0t1.548.639.606 1.514v1.01q3.029.74 4.745 3.231t1.716 5.856v7.134zM14 27.999q-1.211.0-2.053-.808t-.841-2.019h5.788q0 1.144-.875 1.986T14 27.999z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_path" xmlns="http://www.w3.org/2000/svg"><path d="M28 12.62h-9.793V8.414h-2.826v11.173h2.826v-4.206H28V26.62h-9.793v-4.206H12.62v-14H9.794v4.206H.001V1.381h9.793v4.206h8.413V1.381H28V12.62z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052.0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275.0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432.0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981.0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976.0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_shield" xmlns="http://www.w3.org/2000/svg"><path d="M22.167 15.166V3.5h-8.166v20.726c.93-.492 2.424-1.349 3.883-2.497 1.95-1.531 4.284-3.919 4.284-6.562zm3.499-13.999v14c0 7.674-10.737 12.523-11.192 12.724-.146.073-.31.109-.474.109s-.328-.036-.474-.109c-.456-.201-11.192-5.049-11.192-12.724v-14C2.334.529 2.863.0 3.501.0H24.5c.638.0 1.167.529 1.167 1.167z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_star" xmlns="http://www.w3.org/2000/svg"><path d="M14 22.052 5.324 27.31l2.3-9.859L0 10.813l10.056-.854L14 .692l3.944 9.267L28 10.813l-7.624 6.638 2.3 9.859z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_tag" xmlns="http://www.w3.org/2000/svg"><path d="M17.52 17.52v-7.041h-7.041v7.041h7.041zM28 10.479h-7.041v7.041H28v3.439h-7.041V28H17.52v-7.041h-7.041V28H7.04v-7.041H-.001V17.52H7.04v-7.041H-.001V7.04H7.04V-.001h3.439V7.04h7.041V-.001h3.439V7.04H28v3.439z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_timer" xmlns="http://www.w3.org/2000/svg"><path d="M16 29q4.428.0 7.536-3.143t3.107-7.571-3.107-7.536T16 7.643 8.464 10.75t-3.107 7.536 3.107 7.571T16 29zM26.714 9.786q1.214 1.571 2.107 4.036t.893 4.464q0 5.643-4 9.678T16 32t-9.714-4.036-4-9.678 4-9.678T16 4.572q1.929.0 4.464.929t4.107 2.143l2.143-2.214q1.143.929 2.143 2.143zM14.5 19.857v-9.143h3v9.143h-3zM20.571.001v3.071h-9.143V.001h9.143z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_xmpp" xmlns="http://www.w3.org/2000/svg"><path d="M31.995 4.237c-.449.175-1.12.433-1.936.745-1.544.591-2.328.891-2.924 1.093-.613.208-1.287.409-2.635.813-.911.272-1.672.495-2.212.651-.031.875.0 2.177-.292 3.635a21.837 21.837.0 01-2.016 5.765c-1.496 2.944-3.236 4.817-3.88 5.476-.056-.059-.112-.117-.168-.179-.707-.763-2.403-2.703-3.815-5.683-1.053-2.223-1.484-4.044-1.605-4.584-.356-1.589-.427-2.955-.427-4.117.0-.075-.036-.129-.101-.149-.721-.223-1.765-.519-2.887-.853-1.271-.379-2.193-.744-3.408-1.2-.493-.185-1.409-.547-2.217-.859C.723 4.499.113 4.236.041 4.236c-.005.0-.015.0-.023.012a.131.131.0 00-.019.076c.009.593.08 1.361.256 2.365.615 3.503 2.688 7.061 4.36 9.244.0.0 3.717 5.035 9.128 8.144l.303.176c-.009.008-.02.015-.028.021-1.717 1.316-3.201 1.977-3.579 2.14a15.71 15.71.0 01-2.219.772v.407a25.31 25.31.0 002.72-.487 26.72 26.72.0 005.075-1.792c.136.067.276.136.42.204 1.527.725 3.571 1.627 6.073 2.048.613.103 1.136.165 1.507.195a.109.109.0 00.115-.091.55.55.0 00.004-.217.107.107.0 00-.063-.073c-.505-.209-1.201-.4-1.983-.719-.935-.381-2.241-1.067-3.648-2.128a13.528 13.528.0 01-.367-.287c4.64-2.656 7.989-6.588 7.989-6.588 1.735-2.036 4.441-5.623 5.431-9.795.349-1.473.539-2.741.5-3.628z"/></svg></defs></svg><div class=wrapper><input type=checkbox class=hidden id=menu-control>
<input type=checkbox class=hidden id=menu-header-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control tabindex=0><svg class="gdoc-icon gdoc_menu"><title>Open Navigation</title><use xlink:href="#gdoc_menu"/></svg><svg class="gdoc-icon gdoc_arrow_back"><title>Close Navigation</title><use xlink:href="#gdoc_arrow_back"/></svg></label><div><a class="gdoc-brand gdoc-header__link" href=https://rdkit-rs.github.io/><span class="flex align-center"><img class=gdoc-brand__img src=/brand.svg alt>
<span class=gdoc-brand__title>RDKit-rs</span></span></a></div><div class=gdoc-menu-header><span class=gdoc-menu-header__items><span id=gdoc-color-theme><svg class="gdoc-icon gdoc_brightness_dark"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_dark"/></svg><svg class="gdoc-icon gdoc_brightness_light"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_light"/></svg><svg class="gdoc-icon gdoc_brightness_auto"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_auto"/></svg></span><span class=gdoc-menu-header__home><a href=https://rdkit-rs.github.io/ class=gdoc-header__link><svg class="gdoc-icon gdoc_home"><title>Back to homepage</title><use xlink:href="#gdoc_home"/></svg></a></span><span class=gdoc-menu-header__control><label for=menu-header-control><svg class="gdoc-icon gdoc_keyboard_arrow_right"><use xlink:href="#gdoc_keyboard_arrow_right"/><title>Close Menu Bar</title></svg></label></span></span><label for=menu-header-control class=gdoc-menu-header__control><svg class="gdoc-icon gdoc_keyboard_arrow_left"><use xlink:href="#gdoc_keyboard_arrow_left"/><title>Open Menu Bar</title></svg></label></div></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class="gdoc-search flex align-center"><svg class="gdoc-icon gdoc_search"><use xlink:href="#gdoc_search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64 data-site-base-url=https://rdkit-rs.github.io/ data-site-lang=en><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><input type=checkbox class=hidden>
<label><span class=flex>Tutorials</span></label><ul class=gdoc-nav__list><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/tutorials/forking-a-debian-package/ class="gdoc-nav__entry is-active">Forking a Debian Package</a></span></label></li></ul></li></ul></section><section class=gdoc-nav--more></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap
justify-between
hidden-mobile" itemprop=breadcrumb><div><svg class="gdoc-icon gdoc_path hidden-mobile"><use xlink:href="#gdoc_path"/></svg><ol class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemscope itemtype=https://schema.org/WebPage itemprop=item itemid=/ href=/><span itemprop=name>RDKit-rs</span></a><meta itemprop=position content="1"></li><li>/</li><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemscope itemtype=https://schema.org/WebPage itemprop=item itemid=/tutorials/ href=/tutorials/><span itemprop=name>Tutorials</span></a><meta itemprop=position content="2"></li><li>/</li><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Forking a Debian Package</span><meta itemprop=position content="3"></li></ol></div></div><article class="gdoc-markdown gdoc-markdown__align--left"><h1>Forking a Debian Package</h1><p>Debian is an operating system with a rich packaging format and dependency
resolution system. It runs on the Linux kernel and provides <em>over 80,000
packages</em>. Packages ranging from shells like <em>bash</em>, server software like
<em>nginx</em>, desktop software like <em>Firefox</em>, and even full-blown desktop
environments like <em>Gnome</em>. The Ubuntu operating system is a Debian variant which
adopts many of the same packages as Debian, providing a commercial facade and a
different, potentially favorable package lifecycle. Every two years Ubuntu names
a Long Term Support (LTS) release, in this article we&rsquo;ll focus on Ubuntu 22.04
codenamed Jammy, an LTS supported through 2027.</p><p>RDKit is a C++ library and suite of Java/Python modules. Unfortunately Ubuntu
Jammy is providing RDKit 202109 and will not update the major version. Ubuntu
releases pin their entire dependency tree except for bug and security patches.
The RDKit-rs project needs to be flexible and stay up to date on RDKit changes
upstream. We anticipate finding bugs and potentially customizing the RDKit C++
to meet our needs. In short, the RDKit-rs project needs a lot more control over
RDKit.</p><div class=gdoc-page__anchorwrap><h2 id=how-can-we-fork-a-debian-package>How can we fork a Debian package?
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#how-can-we-fork-a-debian-package class="gdoc-page__anchor clip flex align-center" title="Anchor to: How can we fork a Debian package?" aria-label="Anchor to: How can we fork a Debian package?" href=#how-can-we-fork-a-debian-package><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>Forking is a very common thing to solve in the world of git, you just hit the
<code>fork</code> button on Github and copy the repository to your account. Or perhaps you
need to fork a docker image? You can either layer your changes on top of the
original image or you can take the Dockerfile and customize it to your needs,
with easy distribution through <code>docker push</code>/<code>docker pull</code> to a repository.
Unfortunately things are not so easy in the Debian world.</p><p>We&rsquo;ll need to understand:</p><ul><li>what a Debian package is</li><li>how to build a package</li><li>how RDKit is packaged</li><li>how to distribute custom Debian packages. We won&rsquo;t cover starting a package
from scratch.</li></ul><div class=gdoc-page__anchorwrap><h2 id=debian-source-packages>Debian Source Packages
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#debian-source-packages class="gdoc-page__anchor clip flex align-center" title="Anchor to: Debian Source Packages" aria-label="Anchor to: Debian Source Packages" href=#debian-source-packages><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>One goal of Debian is to run herd on the 80,000+ open source packages. Debian
does not maintain forks of these projects, instead preferring static snapshots
of the package source code. Source code is packaged as an untouched <code>.tar.gz</code>
and can be uploaded to Debian repositories for download by clients.</p><p>Once the source is packaged it&rsquo;s time to answer the questions &ldquo;how do we build
something usable out of this source code?&rdquo;. No need to learn how to build every
piece of software, the mechanical steps are captured by the Debian packaging
rules. And similarly, no need to manually fetch build-time and run-time
dependencies for software, those can be tracked by the Debian package
description.</p><div class=gdoc-page__anchorwrap><h2 id=building-a-binary-package-from-source>Building A Binary Package From Source
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#building-a-binary-package-from-source class="gdoc-page__anchor clip flex align-center" title="Anchor to: Building A Binary Package From Source" aria-label="Anchor to: Building A Binary Package From Source" href=#building-a-binary-package-from-source><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>A classic Debian packaging project laid out on disk might look like:</p><pre><code># apt-get source bash
# tree .
|-- bash-5.1
|   |-- ABOUT-NLS
|   |-- AUTHORS
|-- bash_5.1-6ubuntu1.debian.tar.xz
|-- bash_5.1-6ubuntu1.dsc
`-- bash_5.1.orig.tar.xz
</code></pre><p>The <code>bash-5.1</code> directory is unpacked for your convenience using the
<code>.orig.tar.xz</code>. You will need to be inside this directory to build the package.</p><p>The <code>bash_5.1-6ubuntu1.debian.tar.xz</code> contains all the Debian patches and build
instructions. This is a big source of value as it provides a common surface to
the package and once you learn how the parts work you can customize any package.</p><p>The <code>bash_5.1-6ubuntu1.dsc</code> contains the metadata like <code>build-depends</code> so you
can easily fetch required packages to build the software, or <code>depends</code> for
required packages to run the software. It also includes security features like
GPG signature from the packaging author.</p><p>And finally <code>bash_5.1.orig.tar.xz</code> is the untouched snapshot of the source code
from the upstream project. No need to go the bash website to fetch this
software, and no need to worry about the software project deleting a version of
software.</p><p>Build the software with the packaging rules as-is:</p><pre><code># ls
bash-5.1  bash_5.1-6ubuntu1.debian.tar.xz  bash_5.1-6ubuntu1.dsc  bash_5.1.orig.tar.xz
# cd bash-5.1
bash-5.1 # dpkg-buildpackage
[[ SNIP ]]
dpkg-checkbuilddeps: error: Unmet build dependencies: bison libncurses5-dev texinfo texi2html sharutils locales time texlive-latex-base ghostscript texlive-fonts-recommended man2html-base
</code></pre><p>The Debian packaging system doesn&rsquo;t need to build the software to know we don&rsquo;t
have all our prerequisites. We can just install those with the following:</p><pre><code>apt-get install -y bison libncurses5-dev texinfo texi2html sharutils locales time texlive-latex-base ghostscript texlive-fonts-recommended man2html-base
</code></pre><p>In the future we&rsquo;ll use mechanisms that auto install build dependencies. But
after running that install manually we try again:</p><pre><code>bash-5.1# dpkg-buildpackage
dpkg-buildpackage: info: source package bash
dpkg-buildpackage: info: source version 5.1-6ubuntu1
dpkg-buildpackage: info: source distribution jammy
dpkg-buildpackage: info: source changed by Matthias Klose &lt;doko@ubuntu.com&gt;
dpkg-buildpackage: info: host architecture arm64
[[[ SNIP ]]]
Beginning configuration for bash-5.1-release for aarch64-unknown-linux-gnu

checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
</code></pre><p>What&rsquo;s great is that we don&rsquo;t know all the details for how bash is built. No
wrangling autotools, cmake, Makefile, etc. The goal of building a binary has
been boiled down to invoking <code>dpkg-buildpackage</code>. And for the most part you will
use pre-built binaries from the Debian or Ubuntu build farms.</p><div class=gdoc-page__anchorwrap><h2 id=finding-updated-packages>Finding Updated Packages
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#finding-updated-packages class="gdoc-page__anchor clip flex align-center" title="Anchor to: Finding Updated Packages" aria-label="Anchor to: Finding Updated Packages" href=#finding-updated-packages><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>It&rsquo;s great to be able to pull down the source code from the operating system&rsquo;s
repositories. But the development of that package must happen somewhere, new
package versions don&rsquo;t just snap in to existence, they flow from less stable
releases to more stable releases over time.</p><p>If we could just grab that latest work, take responsibility for its contents, we
could build it ourselves and hit fast-forward on versions.</p><p>Unfortunately, at this time of writing, I&rsquo;m not sure where Ubuntu collaborates
on packaging definitions. But we know that Debian packages migrate to Ubuntu
over time, and it&rsquo;s safe to assume Debian is the originator of the RDKit
packaging definition.</p><p>Enter <a class=gdoc-markdown__link href=https://salsa.debian.org>salsa.debian.org</a>, a gitlab installation and
modern home for collaborating on packages in a format that might be familiar to
software developers. Specifically we can look at the
<a class=gdoc-markdown__link href=https://wiki.debian.org/Debichem>DebiChem Pure Blend</a> (a special interest
group focused on making &ldquo;Debian a good platform for chemists in their day-to-day
work&rdquo;) and more specifically we can look at the
<a class=gdoc-markdown__link href=https://salsa.debian.org/debichem-team>DebiChem Salsa Organization</a> and their
<a class=gdoc-markdown__link href=https://salsa.debian.org/debichem-team/rdkit>RDkit project</a>.</p><p>We&rsquo;re going to take the RDKit definition from Salsa and make it our own.</p><div class=gdoc-page__anchorwrap><h2 id=using-git-to-build-source-packages>Using git to build source packages
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#using-git-to-build-source-packages class="gdoc-page__anchor clip flex align-center" title="Anchor to: Using git to build source packages" aria-label="Anchor to: Using git to build source packages" href=#using-git-to-build-source-packages><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>In our opening <em>bash</em> example we were able to pull sources from our regular
repository and just build the software. But when package definitions are tracked
in git we have to use modified techniques. And luckily for us the tooling around
packages in git is quite mature and just the right kind of esoteric.</p><p>The RDKit salsa repository carries on the tradition of tracking snapshots of the
upstream source code &ndash; the repository does <em>not</em> track
<a class=gdoc-markdown__link href=https://github.com/rdkit/rdkit>the official RDKit repository</a>, instead RDKit
on Salsa unpacks static releases and tracks their contents as-is. It does not
carry any commit history from upstream.</p><p>Each official RDKit release is tracked with a corresponding tag. For example,
RDKit 202209.3 gets the tag <code>202209.3</code>. But in the master branch there is a mix
of RDKit C++ code and Debian packaging description in the debian folder. The
tree looks something like this:</p><pre><code>% tree .
.
├── CMakeLists.txt
├── CTestConfig.cmake
├── CTestCustom.ctest.in
├── Code
│   ├── CMakeLists.txt
[[ SNIP ]]
├── debian
│   ├── TODO
│   ├── changelog
│   ├── clean
│   ├── control
│   ├── control.in
│   ├── copyright
│   ├── gbp.conf
│   ├── librdkit-dev.install
│   ├── librdkit1.install
│   ├── librdkit1.lintian-overrides
│   ├── patches
│   │   ├── NoDownloads.patch
[[ SNIP ]]
│   ├── pgversions
│   ├── python-rdkit.links
│   ├── rdkit-data.install
│   ├── rdkit-doc.dirs
│   ├── rdkit-doc.doc-base
│   ├── rules
│   ├── salsa-ci.yml
│   ├── source
│   │   ├── format
│   │   └── lintian-overrides
│   ├── tests
│   │   ├── control
│   │   └── installcheck
│   ├── upstream
│   │   └── metadata
│   └── watch
</code></pre><p>Updating to a newer RDKit release would essential mean clobbering everything
outside the <code>debian/</code> directory with the contents of the Release_YYYY_MM_B.zip
downloaded from the RDKit GitHub releases. It does seem messy to throw away the
commit history of the repository but Debian is only interest in packaging
defined releases, something considered stable software by the source authors.</p><p>We can use <code>gbp</code> (aka, git-buildpackage) to take a tag, build a source
<code>.orig.tar.xz</code> and then apply the <code>debian/</code> rules to construct a binary package.
Think of it like a git-centric workflow using the <code>dpkg-buildpackage</code> from
before alongside a variety of quality-improving tools we&rsquo;ll cover as we go.</p><p>But let&rsquo;s grab rdkit from salsa:</p><pre><code># apt-get install -y git-buildpackage
# git clone https://salsa.debian.org/debichem-team/rdkit.git
# cd rdkit/
</code></pre><p>First we&rsquo;ll consider the top entry in the debian/changelog, this will dictate
the version assigned to the package:</p><pre><code># cat debian/changelog
rdkit (202209.3-2) UNRELEASED; urgency=medium


-- Debichem Team &lt;debichem-devel@lists.alioth.debian.org&gt;  Sat, 14 Jan 2023 13:33:42 +0100
</code></pre><p>So the changelog doesn&rsquo;t say much for humans, but it gives the version
(<code>202209.3-2</code>), author (<code>Debichem Team</code>) and the date the changelog was
generated (<code>Sat, 14 Jan 2023 13:33:42 +0100</code>). So we expect if we use the right
incantations we can build rdkit 202209.3-2.</p><pre><code>rdkit # gbp buildpackage
gbp:error: Pristine-tar couldn't verify &quot;rdkit_202209.3.orig.tar.xz&quot;: fatal: path 'rdkit_202209.3.orig.tar.xz.delta' does not exist in 'refs/remotes/origin/pristine-tar'
pristine-tar: git show refs/remotes/origin/pristine-tar:rdkit_202209.3.orig.tar.xz.delta failed
</code></pre><p>I don&rsquo;t know why we need a pristine tar ref. So we can tell gbp to skip it and
try again:</p><pre><code>rdkit# gbp buildpackage --git-no-pristine-tar
gbp:info: Performing the build
debuild: warning:     debian/changelog(l4): found trailer where expected start of change data
LINE:  -- Debichem Team &lt;debichem-devel@lists.alioth.debian.org&gt;  Sat, 14 Jan 2023 13:33:42 +0100
dpkg-buildpackage -us -uc -ui -i -I
dpkg-buildpackage: warning:     debian/changelog(l4): found trailer where expected start of change data
[[[ SNIP ]]]
dpkg-buildpackage -us -uc -ui -i -I failed
gbp:error: 'debuild -i -I' failed: it exited with 29
</code></pre><p>Ah, our old friend <code>dpkg-buildpackage</code> shows up again. But it fails, it looks
like the debian changelog is not suitable for a build just yet (submitting
broken code happens!), we can edit the changelog:</p><pre><code>rdkit# cat debian/changelog | head -n 10
rdkit (202209.3-2) UNRELEASED; urgency=medium

* Just filling this in

-- Debichem Team &lt;debichem-devel@lists.alioth.debian.org&gt;  Sat, 14 Jan 2023 13:33:42 +0100
</code></pre><p>And try again:</p><pre><code>rdkit # gbp buildpackage --git-no-pristine-tar
gbp:error: You have uncommitted changes in your source tree:
gbp:error: On branch master
Your branch is up to date with 'origin/master'.
</code></pre><p>Turns out the process of running buildpackage had applied patches and dirtied
our git checkout, making gbp suspicious the project was no longer suitable for
release. We can add on another flag to ignore dirty changes in the git repo:</p><pre><code>rdkit # gbp buildpackage --git-no-pristine-tar --git-ignore-new
[[[ SNIP ]]]
dpkg-checkbuilddeps: error: Unmet build dependencies: catch2 cmake dh-python doxygen flex imagemagick latexmk libboost-dev libboost-iostreams-dev libboost-python-dev libboost-regex-dev libboost-system-dev libboost-thread-dev libcairo-dev libcoordgen-dev libeigen3-dev libfreetype6-dev libmaeparser-dev librsvg2-bin libsqlite3-dev pandoc postgresql-server-dev-all python3-dev python3-numpy python3-pandas python3-pil | python3-imaging python3-recommonmark python3-sphinx python3-sqlalchemy rapidjson-dev texlive-latex-extra texlive-latex-recommended
dpkg-buildpackage: warning: build dependencies/conflicts unsatisfied; aborting
</code></pre><p>And again we have an error, similar to the bash build before we are missing
dependencies required to compile the code. The tools won&rsquo;t automatically install
the build dependencies as that could be messy in a dev environment. Why don&rsquo;t we
just jump to sandboxing a build, no need in potentially muddying up a developers
OS.</p><div class=gdoc-page__anchorwrap><h2 id=sandboxing-a-build>Sandboxing A Build
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#sandboxing-a-build class="gdoc-page__anchor clip flex align-center" title="Anchor to: Sandboxing A Build" aria-label="Anchor to: Sandboxing A Build" href=#sandboxing-a-build><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>We want to build our software but we don&rsquo;t want to muddy up the base OS.
Fortunately <code>debootstrap</code> can populate a <em>fresh</em> filesystem inside a directory,
a perfect OS for using <code>chroot</code> and friends to &ldquo;move into&rdquo; a sandbox. The gbp
tool prefers to use cowbuilder for moving into a sandbox, making it easy to
track changes done while building and then resetting the changes, avoiding a
potentially expensive debootstrap to recreate the filesystem.</p><pre><code>rdkit# gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder
gbp:info: Building with (cowbuilder) for sid
gbp:info: Performing the build
Base directory /var/cache/pbuilder/base.cow does not exist
gbp:error: 'git-pbuilder' failed: it exited with 1
</code></pre><p>We have to bootstrap that chroot jail ourselves, setting the distribution name
(by default it wants debian sid). And keep in mind this will inherit the mirror
used in the host OS, I ran this command from a jammy host on aarch64 hence the
use ports.ubuntu.com. If you are going to use a distribution other than Jammy
you need to specify <code>--mirror</code>.</p><pre><code>rdkit # DIST=jammy git-pbuilder create
I: Invoking pbuilder
I: forking: pbuilder create --buildplace /var/cache/pbuilder/base-jammy.cow --mirror http://ports.ubuntu.com/ubuntu-ports/ --distribution jammy --no-targz --extrapackages cowdancer
W: /root/.pbuilderrc does not exist
I: Running in no-targz mode
W: cgroups are not available on the host, not using them.
I: Distribution is jammy.
I: Current time: Wed Mar  8 05:28:28 GMT 2023
I: pbuilder-time-stamp: 1678253308
I: Building the build environment
I: running debootstrap
/usr/sbin/debootstrap
[[[ SNIP ]]]
I: Resolving dependencies of required packages...
I: Resolving dependencies of base packages...
I: Checking component main on http://ports.ubuntu.com/ubuntu-ports...
I: Retrieving adduser 3.118ubuntu5
I: Validating adduser 3.118ubuntu5
I: Retrieving apt 2.4.5
I: Validating apt 2.4.5
[[[ SNIP ]]]
rdkit # du -hs /var/cache/pbuilder/base-jammy.cow
422M    /var/cache/pbuilder/base-jammy.cow
</code></pre><p>and again we retry the sandboxed build, making sure to set the dist option so
gbp will reuse the deboostrap&rsquo;d filesystem:</p><pre><code>rdkit# gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder --git-dist=jammy
gbp:info: Building with (cowbuilder) for jammy
gbp:info: Performing the build
Building with cowbuilder for distribution jammy
W: /root/.pbuilderrc does not exist
I: using cowbuilder as pbuilder
dpkg-checkbuilddeps: error: Unmet build dependencies: bison catch2 cmake dh-python doxygen flex imagemagick latexmk libboost-dev libboost-iostreams-dev libboost-python-dev libboost-regex-dev libboost-system-dev libboost-thread-dev libcairo-dev libcoordgen-dev libeigen3-dev libfreetype6-dev libmaeparser-dev librsvg2-bin libsqlite3-dev pandoc postgresql-server-dev-all python3-dev python3-numpy python3-pandas python3-pil | python3-imaging python3-recommonmark python3-sphinx python3-sqlalchemy rapidjson-dev tex-gyre texlive-fonts-recommended texlive-latex-base texlive-latex-extra texlive-latex-recommended
W: Unmet build-dependency in source
dh /usr/share/postgresql-common/pgxs_debian_control.mk --with python3 --buildsystem=cmake --parallel
dh: error: unable to load addon python3: Can't locate Debian/Debhelper/Sequence/python3.pm in @INC (you may need to install the Debian::Debhelper::Sequence::python3 module) (@INC contains: /etc/perl /usr/local/lib/aarch64-linux-gnu/perl/5.34.0 /usr/local/share/perl/5.34.0 /usr/lib/aarch64-linux-gnu/perl5/5.34 /usr/share/perl5 /usr/lib/aarch64-linux-gnu/perl-base /usr/lib/aarch64-linux-gnu/perl/5.34 /usr/share/perl/5.34 /usr/local/lib/site_perl) at (eval 13) line 1.
BEGIN failed--compilation aborted at (eval 13) line 1.
</code></pre><p>You might be tempted to try and install the build dependencies because you
google around and learn you can log in to the chroot environment and execute
arbitrary commands. Don&rsquo;t go down that path, the error your are seeing is not
really an error and will be resolved by the dpkg machinery. The issue is really
that <code>dh-python</code> is not installed on the host OS.</p><pre><code>rdkit# apt-get install -y dh-python
[[[ SNIP ]]]
</code></pre><p>And then try again:</p><pre><code>rdkit# gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder --git-dist=jammy
gbp:info: Building with (cowbuilder) for jammy
gbp:info: Performing the build
Building with cowbuilder for distribution jammy
W: /root/.pbuilderrc does not exist
I: using cowbuilder as pbuilder
dpkg-checkbuilddeps: error: Unmet build dependencies: bison catch2 cmake doxygen flex imagemagick latexmk libboost-dev libboost-iostreams-dev libboost-python-dev libboost-regex-dev libboost-system-dev libboost-thread-dev libcairo-dev libcoordgen-dev libeigen3-dev libfreetype6-dev libmaeparser-dev librsvg2-bin libsqlite3-dev pandoc postgresql-server-dev-all python3-dev python3-numpy python3-pandas python3-pil | python3-imaging python3-recommonmark python3-sphinx python3-sqlalchemy rapidjson-dev tex-gyre texlive-fonts-recommended texlive-latex-base texlive-latex-extra texlive-latex-recommended
W: Unmet build-dependency in source
dh /usr/share/postgresql-common/pgxs_debian_control.mk --with python3 --buildsystem=cmake --parallel
dh: error: Unknown sequence /usr/share/postgresql-common/pgxs_debian_control.mk (choose from: binary binary-arch binary-indep build build-arch build-indep clean install install-arch install-indep)
debian/rules:37: /usr/share/postgresql-common/pgxs_debian_control.mk: No such file or directory
make: *** [debian/rules:40: /usr/share/postgresql-common/pgxs_debian_control.mk] Error 25
gbp:error: 'git-pbuilder' failed: it exited with 2
</code></pre><p>Now our <code>debian/rules</code> (aka, a Debian packaging-flavored Makefile) is relying on
the existence of a file but failing to load it, causing the Makefile to fail
before package resolution can happen. This is a confusing situation and
definitely points to tool roughness.</p><p>Let&rsquo;s use <code>apt-file</code> to see what packages provides the missing path:</p><pre><code># apt-get install -y apt-file
# apt-file update
# apt-file search /usr/share/postgresql-common/pgxs_debian_control.mk
postgresql-server-dev-all: /usr/share/postgresql-common/pgxs_debian_control.mk
</code></pre><p>And we definitely had <code>postgresql-server-dev-all</code> in the build-depends of
<code>debian/control</code>. Sounds like a race, the <code>debian/rules</code> can&rsquo;t evaluate with a
package from build-depends and the build-depends can&rsquo;t be satisfied until
<code>debian/rules</code> is run. How about we shoe-horn this package in to the
debootstrap&rsquo;d filesystem?</p><p>From the host OS let&rsquo;s see if we can understand this package more:</p><pre><code># apt-cache show postgresql-server-dev-all
# heavily edited output
Package: postgresql-server-dev-all
Section: universe/database
Origin: Ubuntu
Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;
Original-Maintainer: Debian PostgreSQL Maintainers &lt;team+postgresql@tracker.debian.org&gt;
Filename: pool/universe/p/postgresql-common/postgresql-server-dev-all_238_arm64.deb
</code></pre><p>I see a lot of references to <code>universe</code> but I only saw <code>main</code> in the
<code>debootstrap</code> invocation, which I copy here:</p><pre><code>I: forking: pbuilder create --debootstrapopts --include=&quot;postgresql-server-dev-all&quot; --buildplace /var/cache/pbuilder/base-jammy.cow --mirror http://ports.ubuntu.com/ubuntu-ports/ --distribution jammy --no-targz --extrapackages cowdancer
I: Checking component main on http://ports.ubuntu.com/ubuntu-ports...
</code></pre><p>but no <code>universe</code>. Those repositories are described here:
<a class=gdoc-markdown__link href=https://help.ubuntu.com/community/Repositories/Ubuntu>https://help.ubuntu.com/community/Repositories/Ubuntu</a>. But essentially
<code>universe</code> gets less attention from Ubuntu/Canonical but it has this postgresql
dev package.</p><p>so let&rsquo;s destroy our incomplete filesystem and bootstrap it again, including
<code>universe</code> in the package list:</p><pre><code>rdkit# rm -rf /var/cache/pbuilder/base-jammy.cow
rdkit# DIST=jammy git-pbuilder create --debootstrapopts=--components=&quot;main,universe&quot;
[[[ SNIP ]]]
rdkit# gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder --git-dist=jammy
dh /usr/share/postgresql-common/pgxs_debian_control.mk --with python3 --buildsystem=cmake --parallel
make: dh: No such file or directory
debian/rules:37: /usr/share/postgresql-common/pgxs_debian_control.mk: No such file or directory
make: *** [debian/rules:40: /usr/share/postgresql-common/pgxs_debian_control.mk] Error 127
gbp:error: 'git-pbuilder' failed: it exited with 2
</code></pre><p>still erroring on the missing file, the build machinery is not loading the
dependency, so let&rsquo;s recreate the filesystem again but force the install of
<code>postgresql-server-dev-all</code> and <code>debhelper</code> (the source of <code>/usr/bin/dh</code>) and
dh-python (the source of <code>python3</code> support in builds):</p><pre><code># rm -rf /var/cache/pbuilder/base-jammy.cow
# DIST=jammy git-pbuilder create --debootstrapopts=--components=&quot;main,universe&quot; --debootstrapopts=--include=&quot;postgresql-server-dev-all debhelper dh-python&quot;
</code></pre><p>at this point I have used <code>DIST=jammy git-pbuilder login</code> to hop in to the
filesystem and confirm files exist and things are still not working. I&rsquo;m
suspicious if this part of the build is inside the chroot jail or on the host,
let&rsquo;s install on the host:</p><pre><code># apt-get install -y postgresql-server-dev-all debhelper dh-python
# gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder --git-dist=jammy
[[[ SNIP ]]]
pg_buildext checkcontrol
--- debian/control      2023-03-08 17:17:49.451838004 +0000
+++ debian/control.EuTFyl       2023-03-08 17:51:28.825813007 +0000
@@ -166,10 +166,10 @@
.
This package contains the header files.

-Package: postgresql-15-rdkit
+Package: postgresql-14-rdkit
Architecture: any
Section: database
-Depends: ${misc:Depends}, ${shlibs:Depends}, postgresql-15
+Depends: ${misc:Depends}, ${shlibs:Depends}, postgresql-14
Suggests:
Description: Cheminformatics and machine-learning software (PostgreSQL Cartridge)
RDKit is a Python/C++ based cheminformatics and machine-learning software
Error: debian/control needs updating from debian/control.in. Run 'pg_buildext updatecontrol'.
If you are seeing this message in a buildd log, a sourceful upload is required.
make: *** [/usr/share/postgresql-common/pgxs_debian_control.mk:9: debian/control] Error 1
gbp:error: 'git-pbuilder' failed: it exited with 2
</code></pre><p>finally a new error, pointing to a version mismatch between Debian (postgres 15)
and Ubuntu Jammy (postgres 14), let&rsquo;s try running the recommended fix
<code>pg_buildext updatecontrol</code>:</p><pre><code>rdkit# pg_buildext updatecontrol
</code></pre><p>now the <code>debian/control.in</code> has been re-rendered to update <code>debian/control</code> and
we can continue the build:</p><pre><code># gbp buildpackage --git-no-pristine-tar --git-ignore-new --git-pbuilder --git-dist=jammy
gbp:info: Building with (cowbuilder) for jammy
gbp:info: Performing the build
[[[ SNIP ]]]
debian/rules override_dh_auto_clean
make[1]: Entering directory '/rdkit'
find /rdkit -name &quot;*.pyc&quot; | xargs rm -f
[[[ SNIP ]]]
Preparing to unpack .../075-libxcb-shm0_1.14-3ubuntu3_arm64.deb ...
Unpacking libxcb-shm0:arm64 (1.14-3ubuntu3) ...
[[[ SNIP ]]]
make[1]: Entering directory '/build/rdkit-202209.3'
dh_auto_configure -- -DCMAKE_BUILD_TYPE=None -DCMAKE_SKIP_RPATH=ON -DRDK_INSTALL_INTREE=OFF -DRDK_INSTALL_STATIC_LIBS=OFF -DRDK_BUILD_THREADSAFE_SSS=ON -DRDK_BUILD_PYTHON_WRAPPERS=ON -DRDK_OPTIMIZE_POPCNT=OFF -DRDK_USE_URF=OFF -DRDK_INSTALL_COMIC_FONTS=OFF -DRDK_BUILD_CAIRO_SUPPORT=ON -DBoost_NO_BOOST_CMAKE=TRUE -DCMAKE_INSTALL_PREFIX=/usr -DCATCH_DIR=/usr/include/catch2 -DPYTHON_EXECUTABLE=/usr/bin/python3.10 ../
[[[ SNIP ]]]
[  0%] Building CXX object Code/RDGeneral/CMakeFiles/RDGeneral.dir/Invariant.cpp.o
cd /build/rdkit-202209.3/obj-aarch64-linux-gnu/Code/RDGeneral &amp;&amp; /usr/bin/c++ -DBOOST_SERIALIZATION_DYN_LINK -DRDGeneral_EXPORTS -DRDKIT_DYN_LINK -DRDKIT_RDGENERAL_BUILD -DRDK_64BIT_BUILD -DRDK_BUILD_COORDGEN_SUPPORT -DRDK_BUILD_DESCRIPTORS3D -DRDK_BUILD_MAEPARSER_SUPPORT -DRDK_BUILD_THREADSAFE_SSS -DRDK_HAS_EIGEN3 -DRDK_TEST_MULTITHREADED -DRDK_USE_BOOST_SERIALIZATION -DRDK_USE_STRICT_ROTOR_DEFINITION -I/build/rdkit-202209.3/External -I/usr/include/python3.10 -I/usr/lib/python3/dist-packages/numpy/core/include -I/build/rdkit-202209.3/Code -isystem /usr/include/eigen3 -g -O2 -ffile-prefix-map=/build/rdkit-202209.3=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wdate-time -D_FORTIFY_SOURCE=2 -Wno-deprecated -Wno-unused-function -fno-strict-aliasing -Wall -Wextra -fPIC -fPIC -std=gnu++17 -MD -MT Code/RDGeneral/CMakeFiles/RDGeneral.dir/Invariant.cpp.o -MF CMakeFiles/RDGeneral.dir/Invariant.cpp.o.d -o CMakeFiles/RDGeneral.dir/Invariant.cpp.o -c /build/rdkit-202209.3/Code/RDGeneral/Invariant.cpp
</code></pre><p>Finally! We see the C++ compiler is being used, the rdkit source code is
compiled. At the end of the process we will have a collection of debian package
files suitable for installing on Jammy.</p><p>Takeaways:</p><ul><li>bootstrapping the cowbuilder filesystem needs main and universe</li><li>the build host stills needs a fair bit of configuration, installing
<code>postgresql-server-dev-all</code>, <code>debhelper</code>, <code>dh-python</code> which are used outside
the cowbuilder context</li><li>you have to get used to running commands, reading opaque errors, deleting
resources and trying again<ul><li>kudos to cowbuilder for aggressively caching apt downloads</li></ul></li></ul><div class=gdoc-page__anchorwrap><h2 id=moving-the-process-to-github-actions>Moving the process to GitHub Actions
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#moving-the-process-to-github-actions class="gdoc-page__anchor clip flex align-center" title="Anchor to: Moving the process to GitHub Actions" aria-label="Anchor to: Moving the process to GitHub Actions" href=#moving-the-process-to-github-actions><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>In general, we never want to ship production assets from a workstation
environment. We want to build our artifacts in an auditable, open environment
with logging and timestamps. Enter GitHub Actions, a git event-triggered runtime
environment where we can recreate the above workflow.</p><p>You will need to create a <code>.github/workflows/ci.yml</code> with all the above steps
redone in a clean manner:</p><pre><code>name: Build and publish Debian packages

on:
  push: {}

jobs:
  build_amd64:
    runs-on: buildjet-16vcpu-ubuntu-2204
    env:
      DIST: jammy
      ARCH: amd64
      DEB_BUILD_OPTIONS: nocheck

    steps:
      - name: Check out the repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install build tools
        run: sudo apt-get update; sudo apt-get install -y git build-essential git-buildpackage debhelper dh-python

      - name: Create base image
        run: git-pbuilder create

      - name: Remove github stuff
        run: rm -rf .github/

      - name: Build package
        run: gbp buildpackage --git-ignore-new --git-pbuilder --git-no-pristine-tar --git-arch=$ARCH --git-dist=$DIST -us -uc

      - name: Check for debs
        run: ls -alh .; ls -alh ..
</code></pre><p>and at the end of the run you will have <code>.deb</code> files in the filesystem of the
github actions runner:</p><pre><code>total 245M
drwxrwxr-x  3 runner runner 4.0K Mar  7 19:40 .
drwxrwxr-x  6 runner runner 4.0K Mar  7 19:30 ..
-rw-r--r--  1 runner runner 380K Mar  7 19:39 librdkit-dev_202209.3-2_amd64.deb
-rw-r--r--  1 runner runner  88M Mar  7 19:39 librdkit1-dbgsym_202209.3-2_amd64.ddeb
-rw-r--r--  1 runner runner 4.3M Mar  7 19:39 librdkit1_202209.3-2_amd64.deb
-rw-r--r--  1 runner runner 107K Mar  7 19:39 postgresql-15-rdkit_202209.3-2_amd64.deb
-rw-r--r--  1 runner runner  50M Mar  7 19:39 python3-rdkit-dbgsym_202209.3-2_amd64.ddeb
-rw-r--r--  1 runner runner 4.2M Mar  7 19:39 python3-rdkit_202209.3-2_amd64.deb
-rw-r--r--  1 runner runner  13M Mar  7 19:40 rdkit-data_202209.3-2_all.deb
drwxrwxr-x 16 runner runner 4.0K Mar  7 19:32 rdkit-debian
-rw-r--r--  1 runner runner 7.4M Mar  7 19:39 rdkit-doc_202209.3-2_all.deb
-rw-rw-r--  1 runner runner  99K Mar  7 19:33 rdkit_202209.3-2.debian.tar.xz
-rw-rw-r--  1 runner runner 2.0K Mar  7 19:33 rdkit_202209.3-2.dsc
-rw-rw-r--  1 runner runner 2.6M Mar  7 19:40 rdkit_202209.3-2_amd64.build
-rw-r--r--  1 runner runner  19K Mar  7 19:40 rdkit_202209.3-2_amd64.buildinfo
-rw-r--r--  1 runner runner 4.1K Mar  7 19:40 rdkit_202209.3-2_amd64.changes
-rw-r--r--  1 runner runner 1.2K Mar  7 19:40 rdkit_202209.3-2_source.changes
-rw-rw-r--  1 runner runner  76M Mar  7 19:32 rdkit_202209.3.orig.tar.gz
</code></pre><div class=gdoc-page__anchorwrap><h2 id=publishing-debian-packages>Publishing Debian Packages
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#publishing-debian-packages class="gdoc-page__anchor clip flex align-center" title="Anchor to: Publishing Debian Packages" aria-label="Anchor to: Publishing Debian Packages" href=#publishing-debian-packages><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>A <code>.deb</code> file on its own is not the most user-friendly. It can be downloaded to
a machine and manually installed with
<code>dpkg -i librdkit-dev_202209.3-2_amd64.deb</code> but dpkg can&rsquo;t perform any
dependency resolution. You almost always want to use <code>apt</code>, and if you get an
<code>apt</code> compatible archive (the convention is managed by <code>apt-transport-http</code>)
installation becomes as easy as <code>apt-get install $pkg</code></p><p>So what&rsquo;s in an APT HTTP archive? It&rsquo;s a convention of what files exist at what
paths in an HTTP server:</p><ul><li>You don&rsquo;t need any kind of directory listing, just the ability to <code>HTTP GET</code>
files</li><li>A root URI for the archive, for example: <code>https://ports.ubuntu.com/</code></li><li>A distribution/codename which further builds <code>$ROOT_URI/dists/$CODENAME</code> like
<code>https://ports.ubuntu.com/dists/jammy</code></li><li>A repository like <code>main</code> which further builds
<code>$ROOT_URI/dists/$CODENAME/$REPOSITORY</code> like:
<code>https://ports.ubuntu.com/dists/jammy/main</code></li><li>The apt tooling will generate a URI for downloading the full inventory of
available packages, using the host architecture:
<code>$ROOT_URI/dists/$CODENAME/$REPOSITORY/$arch-binary/Packages.gz</code><ul><li>This compressed file has the packages, their dependencies names and
constraints, and relative path information for downloading the deb file. For
example
<code>pool/universe/p/postgresql-common/postgresql-server-dev-all_238_arm64.deb</code></li></ul></li></ul><p>We do not want to maintain all these details of this directory layout and
metadata. And each time we add a new package we have to upsert the details in to
<code>Packages.gz</code>.</p><p>Enter <code>deb-s3</code> which handles the repository layout, uploading files, all in to a
commodity-price S3 bucket.
<a class=gdoc-markdown__link href=https://github.com/deb-s3/deb-s3>Read more on their github page</a>. I won&rsquo;t go
over how to authenticate with AWS for S3, or how to create a public-read S3
bucket. But assuming you have credentials setup, this GitHub Action run will
install deb-s3 and upload the <code>.deb</code> files to the correct spot:</p><pre><code># Upload a file to AWS s3
- name:  Copy index.html to s3
  run: |
    sudo apt-get install ruby awscli
    sudo gem install deb-s3
    aws sts get-caller-identity
    aws s3 ls s3://rdkit-rs-debian/
    deb-s3 upload --bucket=rdkit-rs-debian --s3-region=eu-central-1 --arch=$ARCH --codename=$DIST ../*.deb
</code></pre><p>After a successful deb build I can use the awscli to list our the S3 contents
(remember our bucket doesn&rsquo;t have directory listing):</p><pre><code>% aws s3 ls --recursive s3://rdkit-rs-debian/
2023-03-06 17:30:54       2359 dists/jammy/Release
2023-03-06 17:07:21       9004 dists/jammy/main/binary-amd64/Packages
2023-03-06 17:30:52       2043 dists/jammy/main/binary-amd64/Packages.gz
2023-03-06 17:30:53       9004 dists/jammy/main/binary-arm64/Packages
2023-03-06 17:30:53       2042 dists/jammy/main/binary-arm64/Packages.gz
2023-03-06 17:07:21          0 dists/jammy/main/binary-armhf/Packages
2023-03-06 17:30:52         20 dists/jammy/main/binary-armhf/Packages.gz
2023-03-06 17:07:21          0 dists/jammy/main/binary-i386/Packages
2023-03-06 17:30:52         20 dists/jammy/main/binary-i386/Packages.gz
2023-03-06 17:07:19     388980 pool/jammy/l/li/librdkit-dev_202209.3-2_amd64.deb
2023-03-06 17:30:52     388982 pool/jammy/l/li/librdkit-dev_202209.3-2_arm64.deb
2023-03-06 17:07:20    4471298 pool/jammy/l/li/librdkit1_202209.3-2_amd64.deb
2023-03-06 17:30:53    4143838 pool/jammy/l/li/librdkit1_202209.3-2_arm64.deb
2023-03-06 17:07:20     108884 pool/jammy/p/po/postgresql-15-rdkit_202209.3-2_amd64.deb
2023-03-06 17:30:53     108884 pool/jammy/p/po/postgresql-15-rdkit_202209.3-2_arm64.deb
2023-03-06 17:07:20    4369244 pool/jammy/p/py/python3-rdkit_202209.3-2_amd64.deb
2023-03-06 17:30:53    4350628 pool/jammy/p/py/python3-rdkit_202209.3-2_arm64.deb
2023-03-06 17:07:20   13159982 pool/jammy/r/rd/rdkit-data_202209.3-2_all.deb
2023-03-06 17:07:21    7729828 pool/jammy/r/rd/rdkit-doc_202209.3-2_all.deb
</code></pre><p>Now you can configure a Jammy installation to reference this repository by
configure <code>apt</code> with this config file:</p><pre><code># echo 'deb [trusted=yes] https://rdkit-rs-debian.s3.amazonaws.com jammy main' &gt; /etc/apt/sources.list.d/rdkit-rs.list
# apt-get update
Hit:1 http://ports.ubuntu.com/ubuntu-ports jammy InRelease
Get:2 http://ports.ubuntu.com/ubuntu-ports jammy-updates InRelease [119 kB]
Hit:3 http://ports.ubuntu.com/ubuntu-ports jammy-backports InRelease
Get:4 http://ports.ubuntu.com/ubuntu-ports jammy-security InRelease [110 kB]
Ign:5 https://rdkit-rs-debian.s3.amazonaws.com jammy InRelease
Get:6 http://ports.ubuntu.com/ubuntu-ports jammy-updates arm64 Contents (deb) [54.0 MB]
Get:7 https://rdkit-rs-debian.s3.amazonaws.com jammy Release [2359 B]
Ign:8 https://rdkit-rs-debian.s3.amazonaws.com jammy Release.gpg
Get:9 https://rdkit-rs-debian.s3.amazonaws.com jammy/main arm64 Packages [2042 B]
Get:10 http://ports.ubuntu.com/ubuntu-ports jammy-security arm64 Contents (deb) [47.6 MB]
Fetched 102 MB in 18s (5677 kB/s)
Reading package lists... Done
</code></pre><p>Here you can see apt is able to pull out the metadata from our custom archive,
we can ask apt questions about rdkit packages and get references to both the
official Ubuntu releases and our custom release:</p><pre><code># apt-cache policy librdkit1
librdkit1:
  Installed: (none)
  Candidate: 202209.3-2
  Version table:
     202209.3-2 500
        500 https://rdkit-rs-debian.s3.amazonaws.com jammy/main arm64 Packages
     202109.2-1build1 500
        500 http://ports.ubuntu.com/ubuntu-ports jammy/universe arm64 Packages
</code></pre><p>And luckily our rdkit package has the highest priority, so we can install it
without further configuration:</p><pre><code># apt-get install -y librdkit1
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libboost-iostreams1.74.0 libboost-python1.74.0 libboost-serialization1.74.0 libcairo2 libcoordgen3 libmaeparser1 libpixman-1-0 libxcb-render0 libxcb-shm0 libxrender1
The following NEW packages will be installed:
  libboost-iostreams1.74.0 libboost-python1.74.0 libboost-serialization1.74.0 libcairo2 libcoordgen3 libmaeparser1 libpixman-1-0 librdkit1 libxcb-render0 libxcb-shm0 libxrender1
0 upgraded, 11 newly installed, 0 to remove and 2 not upgraded.
Need to get 6102 kB of archives.
After this operation, 26.7 MB of additional disk space will be used.
Get:1 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libboost-iostreams1.74.0 arm64 1.74.0-14ubuntu3 [243 kB]
Get:2 https://rdkit-rs-debian.s3.amazonaws.com jammy/main arm64 librdkit1 arm64 202209.3-2 [4144 kB]
Get:3 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libboost-python1.74.0 arm64 1.74.0-14ubuntu3 [293 kB]
Get:4 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libboost-serialization1.74.0 arm64 1.74.0-14ubuntu3 [319 kB]
Get:5 http://ports.ubuntu.com/ubuntu-ports jammy-updates/main arm64 libpixman-1-0 arm64 0.40.0-1ubuntu0.22.04.1 [160 kB]
Get:6 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libxcb-render0 arm64 1.14-3ubuntu3 [16.2 kB]
Get:7 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libxcb-shm0 arm64 1.14-3ubuntu3 [5848 B]
Get:8 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libxrender1 arm64 1:0.9.10-1build4 [18.8 kB]
Get:9 http://ports.ubuntu.com/ubuntu-ports jammy/main arm64 libcairo2 arm64 1.16.0-5ubuntu2 [613 kB]
Get:10 http://ports.ubuntu.com/ubuntu-ports jammy/universe arm64 libcoordgen3 arm64 3.0.0-2 [209 kB]
Get:11 http://ports.ubuntu.com/ubuntu-ports jammy/universe arm64 libmaeparser1 arm64 1.2.4-1build1 [80.2 kB]
Fetched 6102 kB in 4s (1725 kB/s)
[[[ SNIP ]]]
</code></pre><p>You can see the apt dependency resolver is mixing S3 debian files with official
files. Meaning we are spliced in to the dependency tree just right!</p><div class=gdoc-page__anchorwrap><h2 id=multi-architecture-build>Multi Architecture Build
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#multi-architecture-build class="gdoc-page__anchor clip flex align-center" title="Anchor to: Multi Architecture Build" aria-label="Anchor to: Multi Architecture Build" href=#multi-architecture-build><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>The rdkit debian packages are built for both amd64 and arm64 &ndash; we anticipate
deploying to a heterogeneous cloud and we anticipate developers coming from both
Intel laptops and M1 laptops. Docker does include a handy runtime translation
engine, powered by QEMU, but we&rsquo;d rather avoid expensive and unstable runtime
translation.</p><p>We build rdkit twice, in two native environments provided by the paid
<a class=gdoc-markdown__link href=https://buildjet.com>buildjet</a> service. It is extra overhead to manage the
service and complicate our environment with a paid service but we could not get
around GitHub Actions limitations: no native ARM64 environment so we needed to
use QEMU build environments and a 60 minute build limit which was easily
exceeded.</p><p>Even though it wasn&rsquo;t our final configuration, we did learn quite a bit about
emulated cross builds from <code>pbuilder</code> and friends. Our notes follow.</p><div class=gdoc-page__anchorwrap><h3 id=cross-compiling>Cross Compiling
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#cross-compiling class="gdoc-page__anchor clip flex align-center" title="Anchor to: Cross Compiling" aria-label="Anchor to: Cross Compiling" href=#cross-compiling><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>True cross compilation would have been preferable, running an amd64-native
binary of GCC to emit code for arm64 &ndash; fast enough to stay inside the free
profile of GitHub Actions. Unfortunately true cross compilation is more than
just installing the GCC binary for cross compilation. It&rsquo;s a full system
configuration nightmare when it comes to libraries. Debian&rsquo;s <code>apt</code> installer
doesn&rsquo;t have an easy way of separating platforms &ndash; you can install foreign
architecture libraries in your system with <code>dpkg --add-architecture arm64</code> but
you will be mixing and matching amd64 and arm64, keeping architectures straight
is tough.</p><div class=gdoc-page__anchorwrap><h3 id=compiling-through-qemu>Compiling Through QEMU
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#compiling-through-qemu class="gdoc-page__anchor clip flex align-center" title="Anchor to: Compiling Through QEMU" aria-label="Anchor to: Compiling Through QEMU" href=#compiling-through-qemu><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>QEMU is a processor and hardware emulator which lets you run, for example, arm64
on amd64. The runtime instruction translation is transparent but has noticeable
overhead. QEMU forms a great base for building arm64 on amd64 through fancy
sandboxes.</p><p>There&rsquo;s a relatively well-documented but still complex constellation of tools
which come together for reproducible build environments inside a Debian host.
Among the many tools, the popular ones: <code>qemu-user-static</code>, <code>chroot</code>, <code>binfmt</code>
(available since Linux 2.1.43), <code>debootstrap</code>, and a variety of glue scripts
like <code>pbuilder</code> and <code>cowbuilder</code>. We can dig in to how to use those tools.</p><div class=gdoc-page__anchorwrap><h3 id=binfmt_misc><code>binfmt_misc</code>
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#binfmt_misc class="gdoc-page__anchor clip flex align-center" title="Anchor to: binfmt_misc" aria-label="Anchor to: binfmt_misc" href=#binfmt_misc><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>Up until this project I assumed QEMU was a full-blown VM with emulation of
system hardware &ndash; but it turns out the Linux kernel allows for an
emulator-per-process architecture. The <code>binfmt</code> feature was new to me but the
documentation helps make it clear this is old news:</p><pre><code>Versions 2.1.43 and later of the Linux kernel have contained the binfmt_misc module. This enables a system administrator to register interpreters for various binary formats based on a magic number or their file extension, and cause the appropriate interpreter to be invoked whenever a matching file is executed. Think of it as a more flexible version of the #! executable interpreter mechanism, or as something which can behave a little like &quot;associations&quot; in certain other operating systems (though in GNU/Linux the tendency is to keep this sort of thing somewhere else, like your file manager). update-binfmts manages a persistent database of these interpreters.
</code></pre><p>You may want to confirm your binfmts is configured correctly in your build
system. You can list out known executable formats and their registered
interpreter:</p><pre><code>update-binfmts --display
</code></pre><p>And look for aarch64 &ndash; we found this format was not configured in our Ubuntu
docker images. Easy to fix:</p><pre><code>update-binfmts --enable qemu-aarch64
</code></pre><div class=gdoc-page__anchorwrap><h3 id=debootstrap><code>debootstrap</code>
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#debootstrap class="gdoc-page__anchor clip flex align-center" title="Anchor to: debootstrap" aria-label="Anchor to: debootstrap" href=#debootstrap><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>Now any aarch64 executable will automatically get instruction translation and
&ldquo;just work&rdquo;. The next question is how to set up a pure aarch64 filesystem in
which to run the build. Enter <code>debootstrap</code>, a tool for unpacking
Debian-flavored operating systems in to a file system. Think of it like the
usual Debian installer but it unzips all the <code>.deb</code> files in to a directory
tree. Remember in these QEMU examples we running from an amd64 host environment.
In general you won&rsquo;t need to but you can run it manually:</p><pre><code># uname -a
Linux ruby-ubuntu-build 5.4.149-73.259.amzn2.x86_64 #1 SMP Mon Sep 27 12:48:12 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
# debootstrap --arch=arm64 --foreign --variant=buildd --verbose --include=fakeroot,build-essential --components=main --resolve-deps --no-merged-usr jammy /tmp/jammy-arm http://ports.ubuntu.com/ubuntu-ports
I: Retrieving InRelease
I: Checking Release signature
I: Valid Release signature (key id F6ECB3762474EDA9D21B7022871920D1991BC93C)
I: Retrieving Packages
I: Validating Packages
I: Resolving dependencies of required packages...
I: Resolving dependencies of base packages...
I: Checking component main on http://ports.ubuntu.com/ubuntu-ports...
I: Retrieving adduser 3.118ubuntu5
I: Validating adduser 3.118ubuntu5
I: Retrieving apt 2.4.5
I: Validating apt 2.4.5
[[[ SNIP ]]]
</code></pre><div class=gdoc-page__anchorwrap><h3 id=chroot><code>chroot</code>
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#chroot class="gdoc-page__anchor clip flex align-center" title="Anchor to: chroot" aria-label="Anchor to: chroot" href=#chroot><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>This debootstrap is now ready to hop in and we can confirm we&rsquo;re in an aarch64
context inside x86 (a unique <code>uname</code> signature for me, up until this point)</p><pre><code># uname -a
Linux ruby-ubuntu-build 5.4.149-73.259.amzn2.x86_64 #1 SMP Mon Sep 27 12:48:12 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
# chroot /tmp/jammy-arm/
# uname -a
Linux ruby-ubuntu-build 5.4.149-73.259.amzn2.x86_64 #1 SMP Mon Sep 27 12:48:12 UTC 2021 aarch64 aarch64 aarch64 GNU/Linux
</code></pre><div class=gdoc-page__anchorwrap><h3 id=streamlining-workflow-with-pbuilder>Streamlining workflow with <code>pbuilder</code>
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#streamlining-workflow-with-pbuilder class="gdoc-page__anchor clip flex align-center" title="Anchor to: Streamlining workflow with pbuilder" aria-label="Anchor to: Streamlining workflow with pbuilder" href=#streamlining-workflow-with-pbuilder><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>Pretty cool! But there&rsquo;s no way we want to do the legwork of copying files in to
the chroot environment and running all the <code>debuild</code> commands to build a binary
deb package.</p><p>The <code>pbuilder</code> family of tools have us covered for this
disposable-foreign-filesystem-and-transparent-process-emulation-for-dpkg-buildpackage
workflow. Making it a few high level commands, mostly wrappers for what we
already covered.</p><div class=gdoc-page__anchorwrap><h3 id=wrapping-debootstrap-with-cowbuilder>Wrapping <code>debootstrap</code> with <code>cowbuilder</code>
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#wrapping-debootstrap-with-cowbuilder class="gdoc-page__anchor clip flex align-center" title="Anchor to: Wrapping debootstrap with cowbuilder" aria-label="Anchor to: Wrapping debootstrap with cowbuilder" href=#wrapping-debootstrap-with-cowbuilder><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>You may have heard of Docker&rsquo;s union filesystem, which provides the ability to
copy-on-write (COW) a docker image&rsquo;s filesystem. The container&rsquo;s filesystem is
built from image layers and the container is allowed to read/write to any file
but it&rsquo;s done in a lazy manner which encourages reuse between containers. For
example, imagine two containers are started from the same image &ndash; your system
would aggressively reuse files between the containers because of lazy file
instantiation. Cowbuilder builds a base filesystem and each debian package build
gets a fresh copy of the filesystem. Any changes to the file system are gone
after a build.</p><p>Note this invocation specifies the mirror to use, by default the fresh OS
inherits from the host&rsquo;s archive configuration. Ubuntu does not mix amd64 and
arm64 packages in the same archive, all arm64 packages are relegated to
<code>ports.ubuntu.com</code>.</p><p>The above arm64</p><p><code>chroot</code> is a command line tool which makes a Linux system call to change a
process&rsquo;s root filesystem. Imagine a filesystem as such:</p><pre tabindex=0><code></code></pre><div class=gdoc-page__anchorwrap><h2 id=conclusion>Conclusion
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#conclusion class="gdoc-page__anchor clip flex align-center" title="Anchor to: Conclusion" aria-label="Anchor to: Conclusion" href=#conclusion><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>We can now install our custom rdkit in seconds, never having to worry about
install build dependencies, those are all relegated to the CI pipeline
environment. The runtime footprint is complete but tight and we can continue to
pull in the wisdom from the DebiChem team while controlling the whole process
for our own needs.</p><p>You can see the whole rdkit-debian repository here:
<a class=gdoc-markdown__link href=https://github.com/rdkit-rs/rdkit-debian>https://github.com/rdkit-rs/rdkit-debian</a></p><div class=gdoc-page__anchorwrap><h2 id=further-reading>Further reading
<a data-clipboard-text=https://rdkit-rs.github.io/tutorials/forking-a-debian-package/#further-reading class="gdoc-page__anchor clip flex align-center" title="Anchor to: Further reading" aria-label="Anchor to: Further reading" href=#further-reading><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><ul><li><a class=gdoc-markdown__link href=http://honk.sigxcpu.org/projects/git-buildpackage/manual-html/gbp.html>http://honk.sigxcpu.org/projects/git-buildpackage/manual-html/gbp.html</a></li><li><a class=gdoc-markdown__link href=https://en.wikipedia.org/wiki/Chroot>https://en.wikipedia.org/wiki/Chroot</a></li><li><a class=gdoc-markdown__link href=https://wiki.debian.org/DebianRepository/Format>https://wiki.debian.org/DebianRepository/Format</a></li></ul></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><nav class="container flex"><div><section class="flex flex-wrap align-center"><span class="gdoc-footer__item gdoc-footer__item--row">Built with <a href=https://gohugo.io/ class=gdoc-footer__link>Hugo</a> and<svg class="gdoc-icon gdoc_heart"><use xlink:href="#gdoc_heart"/></svg></span></section></div><div class="flex flex-25 justify-end"><span class="gdoc-footer__item text-right"><a class="gdoc-footer__link fake-link" href=# aria-label="Back to top"><svg class="gdoc-icon gdoc_keyboard_arrow_up"><use xlink:href="#gdoc_keyboard_arrow_up"/></svg><span class=hidden-mobile>Back to top</span></a></span></div></nav></footer></div><script defer src=/js/search-fd04590d.bundle.min.js></script></body></html>